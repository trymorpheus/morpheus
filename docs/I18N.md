# Internationalization (i18n) Guide

DynamicCRUD includes a complete internationalization system that allows you to display forms, validation messages, and UI elements in multiple languages.

## Features

- **Automatic locale detection** from URL, session, or browser preferences
- **3 languages included**: English (en), Spanish (es), French (fr)
- **Server-side translations**: PHP validation messages, form labels, buttons
- **Client-side translations**: JavaScript validation messages
- **Easy language switching** via URL parameter
- **Extensible**: Add new languages by creating translation files

---

## Quick Start

### 1. Enable i18n in Your Form

```php
<?php
require 'vendor/autoload.php';

use Morpheus\DynamicCRUD;

$pdo = new PDO('mysql:host=localhost;dbname=test', 'root', 'password');

// Pass locale to constructor (optional - auto-detects if not provided)
$crud = new Morpheus($pdo, 'users', locale: 'en');

// Or set locale after instantiation
$crud->setLocale('es');

echo $crud->renderForm();
```

### 2. Language Switcher

```php
<!-- Add language switcher to your page -->
<div class="language-switcher">
    <a href="?lang=en">ðŸ‡¬ðŸ‡§ English</a>
    <a href="?lang=es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</a>
    <a href="?lang=fr">ðŸ‡«ðŸ‡· FranÃ§ais</a>
</div>
```

---

## Locale Detection Priority

The Translator class detects the locale in this order:

1. **URL parameter**: `?lang=en`
2. **Session variable**: `$_SESSION['locale']`
3. **Browser Accept-Language header**: `Accept-Language: es-ES,es;q=0.9`
4. **Default fallback**: `en` (English)

```php
// Example: Force a specific locale
$crud = new Morpheus($pdo, 'users', locale: 'fr');

// Example: Auto-detect from URL/session/browser
$crud = new Morpheus($pdo, 'users');
```

---

## Available Translations

### Validation Messages

| Key | English | Spanish | French |
|-----|---------|---------|--------|
| `validation.required` | The {field} field is required | El campo {field} es requerido | Le champ {field} est requis |
| `validation.email` | The {field} field must be a valid email | El campo {field} debe ser un email vÃ¡lido | Le champ {field} doit Ãªtre un email valide |
| `validation.url` | The {field} field must be a valid URL | El campo {field} debe ser una URL vÃ¡lida | Le champ {field} doit Ãªtre une URL valide |
| `validation.number` | The {field} field must be a number | El campo {field} debe ser un nÃºmero | Le champ {field} doit Ãªtre un nombre |
| `validation.min` | The {field} field must be at least {min} | El campo {field} debe ser mayor o igual a {min} | Le champ {field} doit Ãªtre au moins {min} |
| `validation.max` | The {field} field must be at most {max} | El campo {field} debe ser menor o igual a {max} | Le champ {field} doit Ãªtre au plus {max} |
| `validation.minlength` | The {field} field must be at least {minlength} characters | El campo {field} debe tener al menos {minlength} caracteres | Le champ {field} doit contenir au moins {minlength} caractÃ¨res |
| `validation.maxlength` | The {field} field cannot exceed {maxlength} characters | El campo {field} no puede exceder {maxlength} caracteres | Le champ {field} ne peut pas dÃ©passer {maxlength} caractÃ¨res |

### Form Elements

| Key | English | Spanish | French |
|-----|---------|---------|--------|
| `form.submit` | Submit | Enviar | Soumettre |
| `form.select_option` | -- Select an option -- | -- Seleccione una opciÃ³n -- | -- SÃ©lectionnez une option -- |
| `form.search` | Search... | Buscar... | Rechercher... |
| `form.select_all` | Select All | Seleccionar todo | Tout sÃ©lectionner |
| `form.clear_all` | Clear All | Limpiar todo | Tout effacer |

### Messages

| Key | English | Spanish | French |
|-----|---------|---------|--------|
| `error.csrf_invalid` | Invalid CSRF token | Token CSRF invÃ¡lido | Jeton CSRF invalide |
| `error.validation_failed` | Validation failed | ValidaciÃ³n fallida | Ã‰chec de la validation |
| `success.created` | Record created successfully | Registro creado exitosamente | Enregistrement crÃ©Ã© avec succÃ¨s |
| `success.updated` | Record updated successfully | Registro actualizado exitosamente | Enregistrement mis Ã  jour avec succÃ¨s |
| `success.deleted` | Record deleted successfully | Registro eliminado exitosamente | Enregistrement supprimÃ© avec succÃ¨s |

### Many-to-Many UI

| Key | English | Spanish | French |
|-----|---------|---------|--------|
| `m2m.selected` | {count} selected | {count} seleccionados | {count} sÃ©lectionnÃ©s |
| `m2m.no_results` | No results found | No se encontraron resultados | Aucun rÃ©sultat trouvÃ© |

---

## Adding a New Language

### 1. Create Translation File

Create a new file in `src/I18n/locales/` (e.g., `de.php` for German):

```php
<?php

return [
    // Validation
    'validation.required' => 'Das Feld {field} ist erforderlich',
    'validation.email' => 'Das Feld {field} muss eine gÃ¼ltige E-Mail sein',
    'validation.url' => 'Das Feld {field} muss eine gÃ¼ltige URL sein',
    'validation.number' => 'Das Feld {field} muss eine Zahl sein',
    'validation.min' => 'Das Feld {field} muss mindestens {min} sein',
    'validation.max' => 'Das Feld {field} darf hÃ¶chstens {max} sein',
    'validation.minlength' => 'Das Feld {field} muss mindestens {minlength} Zeichen haben',
    'validation.maxlength' => 'Das Feld {field} darf nicht mehr als {maxlength} Zeichen haben',
    
    // Form elements
    'form.submit' => 'Absenden',
    'form.select_option' => '-- WÃ¤hlen Sie eine Option --',
    'form.search' => 'Suchen...',
    'form.select_all' => 'Alle auswÃ¤hlen',
    'form.clear_all' => 'Alle lÃ¶schen',
    
    // Messages
    'error.csrf_invalid' => 'UngÃ¼ltiges CSRF-Token',
    'error.validation_failed' => 'Validierung fehlgeschlagen',
    'success.created' => 'Datensatz erfolgreich erstellt',
    'success.updated' => 'Datensatz erfolgreich aktualisiert',
    'success.deleted' => 'Datensatz erfolgreich gelÃ¶scht',
    
    // Many-to-many
    'm2m.selected' => '{count} ausgewÃ¤hlt',
    'm2m.no_results' => 'Keine Ergebnisse gefunden',
    
    // Common
    'common.yes' => 'Ja',
    'common.no' => 'Nein',
    'common.cancel' => 'Abbrechen',
    'common.save' => 'Speichern',
    'common.delete' => 'LÃ¶schen',
    'common.edit' => 'Bearbeiten',
    'common.create' => 'Erstellen',
    'common.update' => 'Aktualisieren',
    'common.search' => 'Suchen',
    'common.filter' => 'Filtern',
    'common.loading' => 'Laden...',
    'common.error' => 'Fehler',
    'common.success' => 'Erfolg',
];
```

### 2. Use the New Language

```php
$crud = new Morpheus($pdo, 'users', locale: 'de');
echo $crud->renderForm();
```

---

## Using Translations in Custom Code

### PHP (Server-side)

```php
// Get translator instance
$translator = $crud->getTranslator();

// Translate a key
echo $translator->t('validation.required', ['field' => 'email']);
// Output: "The email field is required"

// Translate with multiple parameters
echo $translator->t('validation.min', ['field' => 'age', 'min' => 18]);
// Output: "The age field must be at least 18"
```

### JavaScript (Client-side)

The FormGenerator automatically injects translations into the page:

```javascript
// Translations are available in window.DynamicCRUDTranslations
const validator = new DynamicCRUDValidator('.dynamic-crud-form');

// Translations are automatically used in validation messages
// No additional code needed!
```

---

## Advanced Usage

### Custom Translator Instance

```php
use Morpheus\I18n\Translator;

// Create translator with specific locale
$translator = new Translator('fr');

// Use in DynamicCRUD
$crud = new Morpheus($pdo, 'users');
$crud->setLocale('fr'); // This creates a new translator internally
```

### Persistent Language Selection

```php
// Store user's language preference in session
if (isset($_GET['lang'])) {
    $_SESSION['locale'] = $_GET['lang'];
}

// Translator will automatically use session locale
$crud = new Morpheus($pdo, 'users');
```

### Fallback Behavior

If a translation key is not found, the Translator returns the key itself:

```php
$translator->t('nonexistent.key');
// Returns: "nonexistent.key"
```

---

## Translation File Structure

All translation files follow this structure:

```php
<?php

return [
    'category.key' => 'Translated text with {parameter}',
    'category.another_key' => 'Another translation',
    // ...
];
```

**Categories:**
- `validation.*` - Validation error messages
- `form.*` - Form UI elements
- `error.*` - Error messages
- `success.*` - Success messages
- `m2m.*` - Many-to-many UI
- `common.*` - Common terms (yes, no, save, etc.)

---

## Browser Language Detection

The Translator automatically detects the browser's preferred language:

```php
// User's browser sends: Accept-Language: es-ES,es;q=0.9,en;q=0.8
$translator = new Translator(); // Auto-detects 'es'
```

**Supported formats:**
- `es-ES` â†’ `es`
- `en-US` â†’ `en`
- `fr-FR` â†’ `fr`
- `es-MX` â†’ `es`

---

## Best Practices

1. **Always use translation keys** instead of hardcoded strings
2. **Use descriptive keys** like `validation.email` instead of `v.e`
3. **Keep parameter names consistent** across languages
4. **Test all languages** before deploying
5. **Provide fallback text** for missing translations
6. **Use URL parameter** for easy language switching
7. **Store user preference** in session or database

---

## Example: Complete Multilingual Form

```php
<?php
require 'vendor/autoload.php';

use Morpheus\DynamicCRUD;

session_start();

// Handle language switching
if (isset($_GET['lang'])) {
    $_SESSION['locale'] = $_GET['lang'];
}

$pdo = new PDO('mysql:host=localhost;dbname=test', 'root', 'password');
$crud = new Morpheus($pdo, 'users');

// Get current locale
$currentLocale = $crud->getTranslator()->getLocale();
?>

<!DOCTYPE html>
<html lang="<?= $currentLocale ?>">
<head>
    <meta charset="UTF-8">
    <title>Multilingual Form</title>
    <link rel="stylesheet" href="assets/dynamiccrud.css">
</head>
<body>
    <div class="language-switcher">
        <a href="?lang=en" <?= $currentLocale === 'en' ? 'class="active"' : '' ?>>ðŸ‡¬ðŸ‡§ English</a>
        <a href="?lang=es" <?= $currentLocale === 'es' ? 'class="active"' : '' ?>>ðŸ‡ªðŸ‡¸ EspaÃ±ol</a>
        <a href="?lang=fr" <?= $currentLocale === 'fr' ? 'class="active"' : '' ?>>ðŸ‡«ðŸ‡· FranÃ§ais</a>
    </div>

    <?php
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $result = $crud->handleSubmission();
        if ($result['success']) {
            echo '<div class="success">' . $crud->getTranslator()->t('success.created') . '</div>';
        } else {
            echo '<div class="error">' . $crud->getTranslator()->t('error.validation_failed') . '</div>';
        }
    }
    
    echo $crud->renderForm($_GET['id'] ?? null);
    ?>
</body>
</html>
```

---

## Troubleshooting

### Translations Not Showing

1. **Clear browser cache**: Press Ctrl+F5 (hard refresh)
2. **Check locale**: Verify `$crud->getTranslator()->getLocale()`
3. **Check translation file**: Ensure the key exists in `src/I18n/locales/{locale}.php`
4. **Check session**: Clear session with `session_destroy()`

### JavaScript Translations Not Working

1. **Hard refresh**: Press Ctrl+F5 to clear JavaScript cache
2. **Check console**: Look for JavaScript errors
3. **Verify injection**: Check page source for `window.DynamicCRUDTranslations`

### Wrong Language Detected

1. **Use URL parameter**: Add `?lang=en` to force a specific language
2. **Check session**: Clear `$_SESSION['locale']`
3. **Check browser settings**: Verify Accept-Language header

---

## See Also

- [Customization Guide](CUSTOMIZATION.md) - Metadata options
- [Hooks System](HOOKS.md) - Lifecycle events
- [Virtual Fields](VIRTUAL_FIELDS.md) - Custom form fields
- [Many-to-Many Guide](MANY_TO_MANY.md) - M:N relationships
